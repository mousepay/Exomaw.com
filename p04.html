<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pista 4 — Mural de sospechosos</title>
<style>
  :root{
    --bg:#0b0b0b; --ink:#eee; --muted:#bdbdbd; --accent:#ffd166;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:#0a0a0a;color:var(--ink);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.6}

  .wrap{max-width:1100px;margin:0 auto;padding:22px}
  h1{margin:.2rem 0}
  .muted{color:var(--muted)}
  .btn{appearance:none;border:1px solid #fff;border-radius:999px;padding:10px 14px;
       font-weight:800;background:#fff;color:#000;cursor:pointer}
  .btn.ghost{background:transparent;color:#fff}
  .btn.primary{background:#59d685;border-color:#59d685;color:#000}
  .btn:active{transform:translateY(1px)}
  .actions{display:flex;flex-wrap:wrap;gap:10px;margin:14px 0}

  /* Mural */
  .board{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.18);
         border-radius:16px;padding:16px;box-shadow:0 20px 50px rgba(0,0,0,.35)}
  .grid{display:grid;gap:18px;grid-template-columns:repeat(4,1fr)}
  @media (max-width:900px){ .grid{grid-template-columns:repeat(2,1fr)} }
  @media (max-width:520px){ .grid{grid-template-columns:1fr} }

  .card{position:relative;aspect-ratio:16/10;perspective:900px;border-radius:14px;overflow:hidden;
        background:#0c0c0c;border:1px solid rgba(255,255,255,.18);cursor:pointer}
  .card-inner{position:absolute;inset:0;transform-style:preserve-3d;transition:transform .6s ease}
  .card.flipped .card-inner{transform:rotateY(180deg)}
  .face{position:absolute;inset:0;backface-visibility:hidden;display:grid;place-items:center;border-radius:14px;overflow:hidden}
  .front{background:#111;border:1px dashed rgba(255,255,255,.2)}
  .front::after{content:"Toca para revelar";font-weight:800;color:#bbb;opacity:.75;font-size:.9rem}
  .back{transform:rotateY(180deg);background:#000}
  .sil{position:absolute;inset:0;background-position:center;background-repeat:no-repeat;background-size:cover;
       filter:drop-shadow(0 8px 18px rgba(0,0,0,.55))}

  .chips{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:7px 11px;border-radius:999px;
        border:1px solid rgba(255,255,255,.35);background:rgba(255,255,255,.08);font-weight:800}
  .chip .x{cursor:pointer;opacity:.75}
  .limit{font-weight:900;color:#000;background:var(--accent);border-radius:999px;padding:2px 8px;margin-right:6px}

  .toast{position:fixed;inset:auto 16px 16px;max-width:640px;background:rgba(0,0,0,.85);
         border:1px solid rgba(255,255,255,.35);border-radius:14px;padding:14px;color:#fff;
         box-shadow:0 20px 60px rgba(0,0,0,.5);display:none;z-index:50}
  .toast.show{display:block}
  .toast h3{margin:.2rem 0 .6rem 0}
  .msg{margin:.25rem 0;padding:.55rem .7rem;border-radius:10px;background:rgba(255,255,255,.06);
       border:1px solid rgba(255,255,255,.15)}
  .note{color:#bbb;font-style:italic;margin-top:10px}
</style>
</head>
<body>

<div class="wrap">
  <div class="actions">
    <!-- Intento primero índice.html; si no, caemos a index.html -->
    <button class="btn ghost" id="backPistas">⟵ Volver a pistas</button>
  </div>

  <h1>Mural de sospechosos</h1>
  <p class="muted">Toca una foto para revelar una silueta. Elige <strong>máximo dos sospechosos</strong> y guárdalos. Después pulsa
    «Interrogar» para leer la pista de cada uno.</p>

  <div class="board">
    <div class="grid" id="grid"></div>

    <div class="actions">
      <span class="limit" id="count">0/2</span>
      <div class="chips" id="chips"></div>
    </div>

    <div class="actions">
      <button class="btn" id="save">Guardar sospechosos</button>
      <button class="btn primary" id="ask">Interrogar</button>
      <button class="btn ghost" id="clear">Limpiar</button>
    </div>

    <p class="note">Las fotos se barajan al cargar, pero se recuerdan mientras sigas en esta sesión.</p>
  </div>
</div>

<div class="toast" id="toast">
  <h3>Interrogatorio</h3>
  <div id="toastBody"></div>
</div>

<script>
/* Volver a pistas: intenta índice.html, si no existe cae a index.html */
document.getElementById('backPistas').addEventListener('click', () => {
  // truco simple: navegamos a índice.html y, tras un tick, redirigimos a index.html por si el primero no existe
  location.href='índice.html';
  setTimeout(()=>{ try{ if(!document.hidden){ location.href='index.html'; } }catch(_){ location.href='index.html'; } }, 60);
});

/* ===== Mural ===== */
(function(){
  const suspects = ['amelia','arturo','azquiel','daniel','lise','nora','ocana','tomas'];
  const messages = {
    amelia: 'Ella te puede guiar.',
    arturo: 'Lo siento, sigue intentando averiguarlo.',
    azquiel:'El observador puede llevarte hasta él.',
    daniel: 'El que se esconde, no se salvará.',
    lise:   'Ella se enteró de todo.',
    nora:   'Sigue intentando, estás muy cerca.',
    ocana:  'Él intuye lo mismo que tú.',
    tomas:  'El dolor perdura en su mente.'
  };
  const fileMap = { daniel: ['daniel.png','daniel1.png'] }; // fallback

  const grid = document.getElementById('grid');
  const chips= document.getElementById('chips');
  const count= document.getElementById('count');
  const btnSave = document.getElementById('save');
  const btnAsk  = document.getElementById('ask');
  const btnClear= document.getElementById('clear');
  const toast   = document.getElementById('toast');
  const toastBody= document.getElementById('toastBody');

  const SKEY = 'p04_suspects_v2';

  let selected = [];
  const revealed = new Set();
  const shuffled = [...suspects].sort(()=>Math.random()-0.5);

  shuffled.forEach(name=>{
    const card = document.createElement('div');
    card.className='card'; card.dataset.name=name;

    const inner=document.createElement('div'); inner.className='card-inner';
    const front=document.createElement('div'); front.className='face front';
    const back =document.createElement('div'); back.className='face back';
    const sil  =document.createElement('div'); sil.className='sil';

    back.appendChild(sil);
    inner.appendChild(front); inner.appendChild(back);
    card.appendChild(inner); grid.appendChild(card);

    card.addEventListener('click', async ()=>{
      if(!revealed.has(card)){
        await setSilhouetteImage(sil, name);
        card.classList.add('flipped'); revealed.add(card);
      }else{
        toggleSelect(name, card);
      }
      updateUI();
    }, {passive:true});
  });

  async function setSilhouetteImage(el, name){
    const files = fileMap[name] ? fileMap[name] : [`${name}.png`];
    for(const f of files){
      if(await probeImage(f)){ el.style.backgroundImage=`url('${f}')`; return; }
    }
    // si no hay imagen, deja un fondo neutro (no rompe)
    el.style.background='linear-gradient(135deg,#111,#222)';
  }
  function probeImage(src){
    return new Promise(res=>{
      const img=new Image();
      img.onload=()=>res(true);
      img.onerror=()=>res(false);
      img.src=src + '?v=' + Date.now(); // evitar caché vieja
    });
  }

  function toggleSelect(name, card){
    const i=selected.indexOf(name);
    if(i>=0){ selected.splice(i,1); card.style.outline=''; }
    else{
      if(selected.length>=2) return;
      selected.push(name);
      card.style.outline='3px solid var(--accent)'; card.style.outlineOffset='-3px';
    }
  }
  function cap(s){return s.charAt(0).toUpperCase()+s.slice(1);}
  function updateUI(){
    count.textContent=`${selected.length}/2`;
    chips.innerHTML=selected.map(n=>`<span class="chip" data-chip="${n}">${cap(n)} <span class="x">✕</span></span>`).join('');
    chips.querySelectorAll('.chip .x').forEach(x=>{
      x.addEventListener('click', ()=>{
        const n=x.parentElement.parentElement.dataset.chip;
        const card=grid.querySelector(`.card[data-name="${n}"]`);
        if(card) card.style.outline='';
        selected=selected.filter(s=>s!==n);
        updateUI();
      });
    });
  }

  btnSave.addEventListener('click', ()=>{
    if(!selected.length){ alert('Elige al menos un sospechoso.'); return; }
    localStorage.setItem(SKEY, JSON.stringify(selected));
    btnSave.textContent = 'Guardado ✓'; setTimeout(()=>btnSave.textContent='Guardar sospechosos', 900);
  });

  btnAsk.addEventListener('click', ()=>{
    if(!selected.length){ alert('Elige al menos un sospechoso.'); return; }
    toastBody.innerHTML=selected.map(n=>{
      const msg=messages[n]||'Sin datos por ahora.';
      return `<div class="msg"><strong>${cap(n)}:</strong> ${msg}</div>`;
    }).join('');
    toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 6000);
  });

  btnClear.addEventListener('click', ()=>{
    selected=[]; grid.querySelectorAll('.card').forEach(c=>c.style.outline=''); updateUI();
  });

  // Restaurar selección guardada (opcional)
  (function restore(){
    try{
      const saved=JSON.parse(localStorage.getItem(SKEY)||'null');
      if(!Array.isArray(saved)) return;
      saved.forEach(n=>{
        const card=grid.querySelector(`.card[data-name="${n}"]`);
        if(card){
          const sil=card.querySelector('.sil');
          setSilhouetteImage(sil,n).then(()=>{
            card.classList.add('flipped'); revealed.add(card);
            toggleSelect(n, card); updateUI();
          });
        }
      });
    }catch(_){}
  })();
})();
</script>
</body>
</html>



