<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pista 3 ‚Äî Taller de relojer√≠a</title>
<style>
  :root{
    --bg:#0b0b0b; --ink:#eee; --muted:#bdbdbd; --accent:#ffd166; --panel:rgba(0,0,0,.6);
    --chip:#fff; --chipText:#000;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.6}

  /* ===== CONTENEDOR V√çDEO ===== */
  .stage{position:relative;min-height:100vh;display:grid;place-items:center;background:#000}
  .videoWrap{position:relative;width:min(100vw,1200px);aspect-ratio:16/9;background:#000;overflow:hidden;border-radius:14px}
  video{width:100%;height:100%;display:block;object-fit:cover}

  /* Frase superpuesta en el v√≠deo */
  .overlay-quote{
    position:absolute;inset:0;display:grid;place-items:end center;
    padding:7vh 6vw 9vh; text-align:center; pointer-events:none;
  }
  .overlay-quote p{
    margin:0; font-weight:800; letter-spacing:.2px;
    font-size:clamp(18px,1.6vw,30px); line-height:1.5;
    text-shadow:0 3px 14px rgba(0,0,0,.85);
    opacity:0; transform:translateY(12px); transition:opacity .8s ease, transform .8s ease;
  }
  .overlay-quote.show p{opacity:1; transform:none}

  /* Bot√≥n para ir al taller */
  .goTaller{
    position:absolute; right:16px; bottom:16px; z-index:5;
    background:var(--panel); border:1px solid rgba(255,255,255,.55);
    color:#fff; font-weight:800; border-radius:12px; padding:10px 14px; cursor:pointer; display:none;
    backdrop-filter:blur(3px);
  }
  .goTaller.show{display:inline-flex}

  /* ===== TALLER ===== */
  .taller{display:none; min-height:100vh; padding:24px 20px 40px; background:#0a0a0a;
    background-image: url('p03.png');
    background-size:cover; background-position:center; background-repeat:no-repeat;
  }
  .scrim{backdrop-filter:blur(3px); background:linear-gradient(180deg,rgba(0,0,0,.65),rgba(0,0,0,.75)); padding:18px; border-radius:16px}
  .wrap{max-width:1200px;margin:0 auto;display:grid;gap:18px}
  .grid{
    display:grid; gap:16px;
    grid-template-columns: 1.1fr .9fr;
  }
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }

  .panel{
    background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.18);
    border-radius:16px; padding:16px 16px 18px; box-shadow:0 20px 50px rgba(0,0,0,.55);
  }
  .panel h2{margin:.2rem 0 6px; font-size:1.2rem}
  .muted{color:var(--muted); margin:0 0 10px; font-style:italic}

  .chips{display:flex; flex-wrap:wrap; gap:10px}
  .chip{
    appearance:none; border:1px solid #fff; background:var(--chip); color:var(--chipText);
    border-radius:999px; padding:8px 12px; font-weight:800; cursor:pointer;
  }
  .chip.ghost{background:transparent;color:#fff;border-color:#fff}
  .chip:active{transform:translateY(1px)}
  .chip[data-active="1"]{box-shadow:0 0 0 3px var(--accent) inset}

  .mezcla{
    display:grid; gap:10px;
    grid-template-columns:1fr 1fr; align-items:center;
  }
  .slot{
    background:#111; border:1px dashed #666; border-radius:12px; min-height:70px;
    display:grid; place-items:center; padding:8px; text-align:center;
  }
  .slot small{color:#aaa}
  .resultado{
    height:90px; border-radius:12px; border:1px solid rgba(255,255,255,.2); background:#111; box-shadow:inset 0 2px 8px rgba(0,0,0,.12);
  }

  .tools{display:flex; flex-wrap:wrap; gap:10px; margin-top:10px}

  /* Lista de f√≥rmulas guardadas */
  .list{display:grid; gap:10px}
  .formula{
    display:flex; align-items:center; gap:10px; background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.18); padding:10px; border-radius:12px;
  }
  .swatch{width:28px;height:28px;border-radius:50%;border:2px solid rgba(255,255,255,.6);flex:0 0 auto}

  /* Inventario */
  .inv-list{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
  .badge{
    background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.25);
    padding:6px 10px; border-radius:999px; font-weight:700
  }

  /* Cabecera del taller */
  .ttl{margin:0 0 4px; font-size:clamp(1.2rem,1rem + 1vw,1.6rem)}
  .sub{margin:0 0 10px; color:#e0e0e0; opacity:.9}

  /* helper visual si no hay p03.png */
  .taller.noimg{background:#0b0b0b}
</style>
</head>
<body>

<!-- ====== ESCENA V√çDEO ====== -->
<section class="stage" id="scene">
  <div class="videoWrap">
    <!-- tu v√≠deo; aseg√∫rate de que p03.mp4 existe en el mismo nivel -->
    <video id="vid" playsinline preload="auto" controls>
      <source src="p03.mp4" type="video/mp4"/>
      Tu navegador no puede reproducir este v√≠deo.
    </video>

    <!-- Frase superpuesta -->
    <div class="overlay-quote" id="quote">
      <p>‚ÄúEl silencio perdura entre las agujas.<br>Escucha bien: no todo lo que se mueve, avanza.‚Äù</p>
    </div>

    <!-- Bot√≥n para saltar al taller -->
    <button class="goTaller" id="goTaller">Ir al taller ‚ü∂</button>
  </div>
</section>

<!-- ====== TALLER ====== -->
<section class="taller" id="taller">
  <div class="wrap">
    <header class="scrim panel">
      <h1 class="ttl">Taller de relojer√≠a</h1>
      <p class="sub">Mezcla barnices y compuestos como lo har√≠a un relojero antiguo. Guarda las f√≥rmulas que te parezcan prometedoras.</p>
      <div class="tools">
        <button class="chip ghost" id="backVideo">‚üµ Volver al v√≠deo</button>
        <button class="chip" id="volverPistas">Volver a las pistas</button>
      </div>
    </header>

    <div class="grid">
      <!-- Ingredientes -->
      <div class="panel scrim">
        <h2>Frascos y compuestos</h2>
        <p class="muted">Pulsa dos frascos para enviarlos a los slots A y B. Luego ‚ÄúMezclar‚Äù.</p>
        <div class="chips" id="frascos">
          <!-- etiqueta="nombre", data-color= color de referencia para mezcla -->
          <button class="chip" data-name="Goma laca"        data-color="#d9a76c">Goma laca</button>
          <button class="chip" data-name="Alcohol et√≠lico"  data-color="#d7e9ff">Alcohol et√≠lico</button>
          <button class="chip" data-name="Di√≥xido de zinc"  data-color="#f4f4f4">Di√≥xido de zinc</button>
          <button class="chip" data-name="√ìxido de hierro"  data-color="#9b4a2f">√ìxido de hierro</button>
          <button class="chip" data-name="Aceite de linaza" data-color="#f3d27a">Aceite de linaza</button>
          <button class="chip" data-name="Bet√∫n de judea"   data-color="#2b1c12">Bet√∫n de judea</button>
          <button class="chip" data-name="Barniz copal"     data-color="#eecb8b">Barniz copal</button>
            <!-- NUEVOS COMPONENTES FOSFORESCENTES -->
  <button class="chip" data-name="Sulfuro de zinc (ZnS)" data-color="#c9ffe6">Sulfuro de zinc (ZnS)</button>
  <button class="chip" data-name="Sales de cobre" data-color="#00ff99">Sales de cobre</button>
  <button class="chip" data-name="Sales de plata" data-color="#00ccff">Sales de plata</button>
  <button class="chip" data-name="Radio-226" data-color="#d4ff00">Radio-226</button>

        </div>

        <div class="mezcla" style="margin-top:12px">
          <div class="slot" id="slotA"><small>Slot A</small></div>
          <div class="slot" id="slotB"><small>Slot B</small></div>
          <div class="resultado" id="resultado" style="grid-column:1/-1"></div>
        </div>

        <div class="tools">
          <button class="chip" id="resolver">Mezclar</button>
          <button class="chip ghost" id="guardar">Guardar f√≥rmula</button>
          <button class="chip ghost" id="limpiar">Limpiar</button>
        </div>
      </div>

      <!-- F√≥rmulas guardadas + Inventario -->
      <div class="panel scrim">
        <h2>F√≥rmulas guardadas</h2>
        <div class="list" id="lista"></div>
        <!-- ===== CAJ√ìN DE PIEZAS (taller) ===== -->
<div class="piecesTray" id="piecesTray" hidden>
  <div class="piecesBar">
    <strong>Piezas del taller</strong>
    <div class="spacer"></div>
    <button type="button" class="pz-btn" id="pzAdd">A√±adir al lienzo</button>
    <button type="button" class="pz-btn" id="pzSave">Guardar posiciones</button>
    <button type="button" class="pz-btn danger" id="pzClear">Borrar todas</button>
  </div>
  <div class="piecesGrid" id="piecesGrid"></div>
  <small class="hint">Arrastra las piezas desde esta bandeja a la hoja. Cada pieza puesta tiene un bot√≥n ‚Äú√ó‚Äù para borrarla.</small>
</div>
<!-- ===== FIN CAJ√ìN DE PIEZAS ===== -->

        <hr style="border:none;border-top:1px solid rgba(255,255,255,.15);margin:14px 0">
        <h2>Inventario</h2>
        <p class="muted">Guarda objetos que ‚Äúrecoges‚Äù del banco de trabajo.</p>
        <div class="tools">
          <button class="chip" id="addPieza">A√±adir pieza de reloj</button>
        </div>
        <div class="inv-list" id="inv"></div>
      </div>
    </div>
  </div>
</section>

<script>
(function(){
  /* ====== FRASE EN EL V√çDEO ====== */
  const vid   = document.getElementById('vid');
  const quote = document.getElementById('quote');
  const goBtn = document.getElementById('goTaller');
  const scene = document.getElementById('scene');
  const taller= document.getElementById('taller');

  // Mostrar frase al reproducir
  function showQuote(){ quote.classList.add('show'); }
  function hideQuote(){ quote.classList.remove('show'); }

  // Muestra el bot√≥n para ir al taller a los 2s o al terminar
  vid.addEventListener('play', () => {
    showQuote();
    // si no hay controles usados, mostramos el bot√≥n tras 2s
    setTimeout(()=> goBtn.classList.add('show'), 2000);
  });
  vid.addEventListener('ended', () => goBtn.classList.add('show'));

  // Ir al taller
  function openTaller(){
    scene.style.display = 'none';
    taller.style.display = 'block';
    // si no existe imagen de fondo, evita ‚Äúrota‚Äù
    const url = getComputedStyle(taller).backgroundImage;
    if (!url || url === 'none') taller.classList.add('noimg');
  }
  goBtn.addEventListener('click', openTaller);

  // Volver al v√≠deo
  document.getElementById('backVideo').addEventListener('click', ()=>{
    taller.style.display = 'none';
    scene.style.display  = 'grid';
    vid.focus();
  });

  // Volver a las pistas (ajusta el destino si tus pistas est√°n en otra p√°gina)
  document.getElementById('volverPistas').addEventListener('click', ()=>{
    window.location.href = 'index.html';
  });

  /* ====== L√ìGICA DEL TALLER ====== */
  const slotA = document.getElementById('slotA');
  const slotB = document.getElementById('slotB');
  const res   = document.getElementById('resultado');
  const lista = document.getElementById('lista');

  const SKEY_FORM = 'p03_formulas';
  const SKEY_INV  = 'p03_inventario';

  let selA = null, selB = null;

  // Selecci√≥n de frascos
  document.getElementById('frascos').addEventListener('click', (e)=>{
    const btn = e.target.closest('.chip'); if(!btn) return;
    const item = { name: btn.dataset.name, color: btn.dataset.color };

    if(!selA){
      selA = item; renderSlot(slotA, selA); mark(btn);
      return;
    }
    if(!selB && item.name !== selA.name){
      selB = item; renderSlot(slotB, selB); mark(btn);
      return;
    }

    // si ambas llenas, reemplazamos A -> B -> nuevo en A
    clearSlots(); selA = item; renderSlot(slotA, selA); mark(btn,true);
  });

  function mark(btn, only){
    // Marcar activo visualmente
    if(only){
      document.querySelectorAll('.chip[data-active="1"]').forEach(b=>b.dataset.active='0');
    }
    btn.dataset.active = btn.dataset.active === '1' ? '0' : '1';
  }

  function renderSlot(slot, data){
    slot.innerHTML = '<strong>'+data.name+'</strong>';
    slot.style.borderColor = data.color;
    slot.style.boxShadow   = '0 0 0 3px '+data.color+'20 inset';
  }

  function clearSlots(){
    selA = selB = null;
    slotA.innerHTML = '<small>Slot A</small>';
    slotB.innerHTML = '<small>Slot B</small>';
    slotA.style = slotB.style = '';
    res.style.background = '#111';
  }

  // Mezcla simple: promedio de colores
  function hex2rgb(h){
    const c = h.replace('#','');
    return { r:parseInt(c.substring(0,2),16), g:parseInt(c.substring(2,4),16), b:parseInt(c.substring(4,6),16) };
  }
  function rgb2hex(r,g,b){
    const to = v => ('0'+v.toString(16)).slice(-2);
    return '#'+to(r)+to(g)+to(b);
  }
  function mix(a,b){
    const A = hex2rgb(a), B = hex2rgb(b);
    return rgb2hex( Math.round((A.r+B.r)/2), Math.round((A.g+B.g)/2), Math.round((A.b+B.b)/2) );
  }

  document.getElementById('resolver').addEventListener('click', ()=>{
    if(!selA || !selB) return alert('Elige dos frascos (A y B).');
    const color = mix(selA.color, selB.color);
    res.style.background = color;
    res.dataset.color = color;
  });

  document.getElementById('limpiar').addEventListener('click', ()=>{
    clearSlots();
    document.querySelectorAll('.chip[data-active="1"]').forEach(b=>b.dataset.active='0');
  });

  // Guardar f√≥rmula
  document.getElementById('guardar').addEventListener('click', ()=>{
    const color = res.dataset.color;
    if(!selA || !selB || !color) return alert('Mezcla primero dos frascos.');
    const entry = { a: selA.name, b: selB.name, color, ts: Date.now() };
    const arr = load(SKEY_FORM); arr.push(entry); save(SKEY_FORM, arr); paintList();
  });

  function paintList(){
    const arr = load(SKEY_FORM);
    if(!arr.length){ lista.innerHTML = '<em class="muted">(Vac√≠o)</em>'; return; }
    lista.innerHTML = arr.map(it => `
      <div class="formula">
        <span class="swatch" style="background:${it.color}"></span>
        <div style="flex:1 1 auto">
          <strong>${it.a}</strong> + <strong>${it.b}</strong><br>
          <small style="color:#ccc">${new Date(it.ts).toLocaleString()}</small>
        </div>
        <button class="chip ghost" data-del="${it.ts}">Eliminar</button>
      </div>
    `).join('');
  }
  lista.addEventListener('click', (e)=>{
    const del = e.target.closest('[data-del]'); if(!del) return;
    const ts = Number(del.dataset.del);
    const arr = load(SKEY_FORM).filter(x => x.ts !== ts);
    save(SKEY_FORM, arr); paintList();
  });

  // Inventario
  const invWrap = document.getElementById('inv');
  document.getElementById('addPieza').addEventListener('click', ()=>{
    const arr = load(SKEY_INV); arr.push({name:'Pieza de reloj', ts:Date.now()});
    save(SKEY_INV, arr); paintInv();
  });
  function paintInv(){
    const arr = load(SKEY_INV);
    invWrap.innerHTML = arr.length ? arr.map(i=>`<span class="badge">üß© ${i.name}</span>`).join('') : '<em class="muted">(Inventario vac√≠o)</em>';
  }

  // storage helpers
  function load(k){ try{ return JSON.parse(localStorage.getItem(k)||'[]'); }catch(_){ return []; } }
  function save(k,v){ localStorage.setItem(k, JSON.stringify(v)); }

  // arranque
  paintList(); paintInv();

})();
</script>
</body>
</html>



