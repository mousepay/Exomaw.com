<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pista 5 — El enigma de las agujas (SVG)</title>
<style>
  :root{
    --ink:#093730; --muted:#2b5e55; --ok:#0b8d42; --bad:#c33a2f; --warn:#f0b429;
    --glass: rgba(255,255,255,.86);
    --panel: #ffffff;
    --brand:#0ea5a3;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink)}
  body{
    /* Si quieres tu foto de butacas: descomenta la línea siguiente y pon la URL */
    /* background: url('fondo.png') center/cover fixed no-repeat; */
    background: radial-gradient(1200px 900px at 30% 0%, #eaf7f2, #d8efe6 60%, #cde6de);
  }
  .wrap{max-width:1200px;margin:22px auto 96px;padding:0 16px}
  .top{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .back{border:1px solid #cfe6df;background:#f5fbf9;color:#1c534a;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  h1{margin:6px 0 16px;font-size:clamp(26px,4vw,44px);color:#fff;text-shadow:0 2px 18px rgba(0,0,0,.45)}
  .card{background:var(--glass);backdrop-filter: blur(6px); border:1px solid rgba(0,0,0,.08); border-radius:18px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.18)}
  .areas{display:grid;gap:18px;grid-template-columns:1fr 1fr}
  @media(max-width:980px){.areas{grid-template-columns:1fr}}
  .panel-title{font-size:22px;margin:2px 0 10px;color:#0e4c41}
  .slots,.library{
    background:#fff; border:1px dashed rgba(0,0,0,.2);
    border-radius:16px; padding:16px; min-height:280px;
    display:grid; grid-template-columns:repeat(4,minmax(120px,1fr)); gap:14px;
  }
  .slot,.needle{
    position:relative; display:flex; align-items:center; justify-content:center;
    border-radius:14px; overflow:hidden; min-height:150px;
    background:#f5faf8; border:1px solid rgba(0,0,0,.12);
    box-shadow: inset 0 12px 24px rgba(0,0,0,.05);
  }
  .slot .ghost{position:absolute; inset:10px; opacity:.25; filter:grayscale(1) contrast(.9); pointer-events:none}
  .slot.is-target{outline:2px solid var(--warn); box-shadow: 0 0 0 6px rgba(240,180,41,.15) inset}
  .slot.correct{outline:2px solid var(--ok); box-shadow: 0 0 0 6px rgba(11,141,66,.18) inset}
  .slot.fail{outline:2px solid var(--bad); box-shadow: 0 0 0 6px rgba(195,58,47,.18) inset}
  .needle{cursor:grab; transition: transform .08s ease}
  .needle:active{cursor:grabbing; transform: scale(.98)}
  svg{width:90px; height:120px}
  .glow{filter: drop-shadow(0 0 10px rgba(255,255,160,.9)) drop-shadow(0 0 20px rgba(255,255,160,.7))}
  .hint{font-size:14px;color:#0f4c42}
  .final{display:none;margin-top:12px;padding:12px;background:#f2fbf8;border:1px solid rgba(0,0,0,.1);border-radius:12px;color:#0a3a32}
  .btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  .primary{background:var(--brand);color:#053f3b}
  .flash{position:fixed;inset:0;pointer-events:none;background:radial-gradient(circle at 50% 45%,rgba(255,255,255,.9),rgba(255,255,255,0) 55%);opacity:0;transition:opacity .35s}
  .flash.on{opacity:1;animation:fadeFlash .9s ease forwards}
  @keyframes fadeFlash{0%{opacity:1}60%{opacity:.45}100%{opacity:0}}
  .toast{position:fixed;left:12px;bottom:14px;background:#fff;border:1px solid rgba(0,0,0,.12);padding:8px 12px;border-radius:10px;box-shadow:0 10px 24px rgba(0,0,0,.2);display:none}
</style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <button class="back" onclick="history.back()">← Volver a las pistas</button>
      <h1>PISTA 5 — El enigma de las agujas</h1>
    </div>

    <div class="card">
      <p>Arrastra cada <strong>aguja</strong> desde la biblioteca hasta su <strong>molde</strong> (sombra). Tienes <strong>3 fallos</strong> en total. Al colocar todas y la <em>aguja de luz</em>, aparecerá el mensaje final.</p>

      <div class="areas">
        <section>
          <div class="panel-title">Ranuras (sombras)</div>
          <div id="slots" class="slots"></div>
          <p class="hint">Las sombras son la silueta real a baja opacidad: encaja por forma, no por texto.</p>
        </section>

        <section>
          <div class="panel-title">Biblioteca de agujas</div>
          <div id="library" class="library"></div>
          <p class="hint">Busca diferencias: punta, contrapeso, grosor, longitud… Una brilla: es la <em>aguja de luz</em>.</p>
        </section>
      </div>

      <div id="finalBox" class="final"></div>
    </div>
  </div>

  <div id="flash" class="flash"></div>
  <div id="toast" class="toast"></div>

<script>
/* ===== util ===== */
const $ = s => document.querySelector(s);
function toast(t, ms=1600){ const b=$("#toast"); b.textContent=t; b.style.display="block"; setTimeout(()=>b.style.display="none", ms); }

/* ===== generador de agujas SVG (sin imágenes) ===== */
function needleSVG({shaft=56, tip="arrow", weight="circle", thick=3, glow=false}={}){
  const w=90,h=120, cx=w/2, top=20, bot=top+shaft;
  // eje
  const line = `<rect x="${cx-thick/2}" y="${top}" width="${thick}" height="${shaft}" rx="${thick/2}" fill="#0c2839"/>`;
  // punta
  let p="";
  if(tip==="arrow"){
    p = `<polygon points="${cx},${top-10} ${cx-8},${top+6} ${cx+8},${top+6}" fill="#0c2839"/>`;
  } else if(tip==="needle"){
    p = `<rect x="${cx-(thick-1)/2}" y="${top-10}" width="${thick-1}" height="10" fill="#0c2839"/>`;
  } else { // diamond
    p = `<polygon points="${cx},${top-9} ${cx-7},${top} ${cx},${top+9} ${cx+7},${top}" fill="#0c2839"/>`;
  }
  // contrapeso
  let wgt="";
  if(weight==="circle"){
    wgt = `<circle cx="${cx}" cy="${bot+10}" r="${6+Math.max(0,thick-3)}" fill="#0c2839"/>`;
  } else if(weight==="spike"){
    wgt = `<rect x="${cx-(thick+2)/2}" y="${bot}" width="${thick+2}" height="14" rx="2" fill="#0c2839"/>`;
  } else { // ring
    wgt = `<circle cx="${cx}" cy="${bot+10}" r="${8}" fill="none" stroke="#0c2839" stroke-width="2"/>`;
  }
  const frame = `
    <rect x="8" y="6" width="${w-16}" height="${h-12}" rx="10" fill="none" stroke="#1d4d46" stroke-width="2"/>
  `;
  const g = glow ? 'class="glow"' : '';
  return `<svg viewBox="0 0 ${w} ${h}" ${g} aria-hidden="true">${frame}${line}${p}${wgt}</svg>`;
}

/* ===== datos de 12 agujas únicas ===== */
const MODELS = [
  {shaft:58, tip:"arrow",  weight:"circle", thick:3},
  {shaft:62, tip:"diamond",weight:"spike",  thick:3},
  {shaft:54, tip:"needle", weight:"ring",   thick:4},
  {shaft:60, tip:"arrow",  weight:"ring",   thick:2},
  {shaft:52, tip:"diamond",weight:"circle", thick:4},
  {shaft:66, tip:"needle", weight:"spike",  thick:2},
  {shaft:56, tip:"arrow",  weight:"spike",  thick:4},
  {shaft:64, tip:"diamond",weight:"ring",   thick:3},
  {shaft:50, tip:"needle", weight:"circle", thick:3},
  {shaft:68, tip:"arrow",  weight:"circle", thick:2},
  {shaft:58, tip:"diamond",weight:"spike",  thick:5},
  {shaft:60, tip:"needle", weight:"ring",   thick:3, glow:true} // aguja de luz
];

/* ===== construcción de UI ===== */
const slots = $("#slots");
const lib = $("#library");
let fails=0, solved=0;

function build(){
  slots.innerHTML=""; lib.innerHTML=""; fails=0; solved=0; $("#finalBox").style.display="none";
  // Creamos slots con su sombra exacta
  MODELS.forEach((m, i)=>{
    const s=document.createElement("div");
    s.className="slot"; s.dataset.accept = String(i);
    const ghost=document.createElement("div");
    ghost.className="ghost";
    ghost.innerHTML = needleSVG(m);
    s.appendChild(ghost);
    s.addEventListener("dragover", e=>{e.preventDefault(); s.classList.add("is-target");});
    s.addEventListener("dragleave", ()=> s.classList.remove("is-target"));
    s.addEventListener("drop", e=>{
      e.preventDefault(); s.classList.remove("is-target");
      const id = e.dataTransfer.getData("text/needle");
      handleDrop(s,id);
    });
    slots.appendChild(s);
  });
  // Creamos biblioteca (desordenada)
  const order = Array.from(MODELS.keys());
  order.sort(()=>Math.random()-.5);
  order.forEach(i=>{
    const d=document.createElement("div");
    d.className="needle"; d.draggable=true; d.dataset.id=String(i);
    d.addEventListener("dragstart", e=> e.dataTransfer.setData("text/needle", String(i)));
    d.innerHTML = needleSVG(MODELS[i]);
    lib.appendChild(d);
  });
}

function handleDrop(slot, id){
  if(slot.classList.contains("correct")){ toast("Esa ranura ya está completa"); return; }
  if(id===slot.dataset.accept){
    slot.classList.add("correct");
    solved++;
    const model = MODELS[+id];
    slot.innerHTML = needleSVG(model);
    toast(["¡Precisión impecable!","¡Encaja perfecto!","Otro paso al centro."][Math.floor(Math.random()*3)]);
    if(model.glow){ const f=$("#flash"); f.classList.add("on"); setTimeout(()=>f.classList.remove("on"),900); }
    if(solved===MODELS.length){ showFinal(); }
  } else {
    slot.classList.add("fail"); setTimeout(()=>slot.classList.remove("fail"),700);
    fails++;
    if(fails>=3){ toast("Tres fallos. El mecanismo se reinicia…",2000); setTimeout(build,900); }
    else { toast(["Casi… fíjate en la punta.","Mira el contrapeso.","Atiende al grosor y longitud."][Math.floor(Math.random()*3)]); }
  }
}

function showFinal(){
  const box=$("#finalBox");
  box.style.display="block";
  box.innerHTML = `
    <strong>¡Puzzle completo!</strong><br>
    Las agujas te lo susurran: <em>siempre apuntan a tu centro</em>.<br><br>
    Nora: <em>Has llegado al final del crimen… ¿me seguirás en mi próxima novela?</em><br><br>
    <button class="btn primary" onclick="location.href='pista-final.html'">Continuar</button>
  `;
}

build();
</script>
</body>
</html>











