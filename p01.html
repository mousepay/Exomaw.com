<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pista + Libreta (B/N) con sangre al cerrar</title>
<style>
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:#0b0b0b;color:#eee;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.6}

  /* ===== HERO con imagen ===== */
  .hero{position:relative;min-height:72vh;display:grid;place-items:center;overflow:hidden;background:#000}
  .bg{position:absolute;inset:0;background-position:center;background-size:cover;background-repeat:no-repeat;filter:grayscale(100%) contrast(115%) brightness(.85);z-index:0}
  .shade{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.65));z-index:0}

  /* Sangre */
  .blood{position:absolute;inset:0;pointer-events:none;z-index:1;mix-blend-mode:multiply;opacity:.85}
  .blood[data-on="0"]{display:none}
  .blood::before,.blood::after{
    content:"";position:absolute;left:0;top:-110%;width:100%;height:220%;
    background:
      radial-gradient(40px 140px at 8% 0%,  rgba(90,0,0,.75), transparent 70%),
      radial-gradient(60px 180px at 24% 0%, rgba(90,0,0,.8),  transparent 70%),
      radial-gradient(50px 160px at 46% 0%, rgba(70,0,0,.75),  transparent 70%),
      radial-gradient(70px 200px at 70% 0%, rgba(80,0,0,.8),  transparent 70%),
      radial-gradient(40px 140px at 88% 0%, rgba(70,0,0,.75),  transparent 70%),
      linear-gradient(180deg, rgba(30,0,0,.7), rgba(10,0,0,.92) 55%, rgba(0,0,0,0) 90%);
    filter:blur(1px);
    animation: drip 18s linear infinite;
  }
  .blood::after{animation-delay:-9s;opacity:.9}

  .blood.flood::before,.blood.flood::after{animation: cover 9s ease-in forwards;}
  @keyframes drip{0%{transform:translateY(-7%)}100%{transform:translateY(7%)}}
  @keyframes cover{0%{transform:translateY(-20%);opacity:.9}50%{transform:translateY(10%);opacity:1}100%{transform:translateY(40%);opacity:1}}

  /* Panel de frase (con X) */
  .panel{position:relative;z-index:2;width:min(1200px,92vw);background:rgba(0,0,0,.55);backdrop-filter:blur(4px);
    border:1px solid rgba(255,255,255,.2);border-radius:16px;padding:clamp(18px,2.8vw,34px);box-shadow:0 24px 60px rgba(0,0,0,.55);text-align:center}
  .panel.hidden{display:none}
  .panel .closePhrase{position:absolute;top:10px;right:12px;background:transparent;border:1px solid rgba(255,255,255,.6);color:#fff;
    width:32px;height:32px;border-radius:50%;font-size:18px;line-height:30px;cursor:pointer}

  .q{margin:0 0 14px;color:#fff;font-weight:900;letter-spacing:.2px;font-size:clamp(1.25rem,1rem + 2.4vw,3.1rem);
    text-shadow:0 3px 12px rgba(0,0,0,.85),0 0 1px rgba(255,255,255,.25)}
  .meta{margin:0 0 18px;color:#e0e0e0;font-style:italic;font-size:clamp(.96rem,.9rem + .55vw,1.2rem);text-shadow:0 2px 8px rgba(0,0,0,.8);opacity:.95}

  .actions{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
  .btn{background:#fff;color:#000;border:1px solid #fff;border-radius:12px;padding:10px 16px;font-weight:800;cursor:pointer;
    box-shadow:0 8px 26px rgba(0,0,0,.55);transition:transform .08s ease}
  .btn:active{transform:translateY(1px) scale(.99)}
  .btn-ghost{background:transparent;color:#fff;border-color:#fff}
  .slot-volver{display:inline-block}

  /* Botón flotante para volver a mostrar la frase */
  .showPhrase{position:fixed;right:14px;bottom:14px;z-index:9000;background:rgba(0,0,0,.6);color:#fff;border:1px solid #fff;border-radius:10px;
    padding:8px 12px;font-weight:700;cursor:pointer;backdrop-filter:blur(2px);display:none}

  /* ===== MODAL Libreta ===== */
  .modal[aria-hidden="true"]{display:none}
  .modal[aria-hidden="false"]{display:block}
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.72);backdrop-filter:blur(2px);z-index:10000}
  .mw{position:fixed;inset:0;display:grid;place-items:center;pointer-events:none;padding:16px;z-index:10001}
  .book,.page{pointer-events:auto;height:min(78vh,780px)}
  .book{width:min(44vw,520px);background:repeating-linear-gradient(135deg,#222,#222 14px,#111 14px,#111 28px);border-radius:18px 0 0 18px;
    box-shadow:0 18px 60px rgba(0,0,0,.7);transform-origin:left center;animation:open 900ms cubic-bezier(.2,.8,.2,1) forwards}
  .page{--paper:#111;--ink:#f1f1f1;--line:#fff;
    width:min(54vw,760px);background:var(--paper);color:var(--ink);border:2px solid #000;border-left:0;
    border-radius:0 18px 18px 0;box-shadow:0 18px 60px rgba(0,0,0,.8);padding:14px 16px 16px;position:relative;overflow:hidden}
  .page.light{--paper:#fff;--ink:#111;--line:#000}
  .page::before{content:"";position:absolute;inset:0;background:repeating-linear-gradient(var(--paper),var(--paper) 26px,rgba(0,0,0,.07) 27px);opacity:.35;pointer-events:none}
  .head{position:relative;display:flex;justify-content:space-between;align-items:center;z-index:2}
  .ttl{margin:0;font-size:1.05rem}
  .close{background:transparent;color:var(--ink);border:0;font-size:1.8rem;line-height:1;cursor:pointer;padding:0 6px}
  .tools{display:flex;justify-content:space-between;align-items:center;gap:.75rem;z-index:2;position:relative;margin-top:8px}
  .left{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}
  .toggle{background:transparent;color:var(--ink);border:1px solid var(--ink);padding:6px 10px;border-radius:8px;font-weight:800;cursor:pointer}
  .ctl{background:#000;color:#fff;border:1px solid #000;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
  .page:not(.light) .ctl{background:#fff;color:#000;border-color:#fff}
  .label{display:block;margin:10px 0 6px;color:var(--ink);z-index:2;position:relative}
  .ta{width:100%;min-height:220px;resize:vertical;padding:12px 12px 12px 16px;border-radius:12px;border:1px dashed var(--line);
    background:color-mix(in srgb,var(--paper) 92%, white 8%);color:var(--ink);outline:none;box-shadow:inset 0 2px 8px rgba(0,0,0,.08);z-index:2;position:relative}
  .board{width:100%;height:260px;background:var(--paper);border:1px solid var(--line);border-radius:12px;display:block;cursor:crosshair;box-shadow:inset 0 2px 8px rgba(0,0,0,.08)}
  .ft{margin-top:8px;color:var(--ink);z-index:2;position:relative}
  @keyframes open{0%{transform:perspective(1200px) rotateY(0)}60%{transform:perspective(1200px) rotateY(-115deg)}100%{transform:perspective(1200px) rotateY(-180deg)}}
  @media (max-width:960px){.book{display:none}.page{width:min(94vw,760px);border-radius:14px;border-left:2px solid #000}}

  /* Ocultar botones que no quieres */
  #toolPen,#toolEraser,#downloadNotesTop,#downloadNotesIn,#clearBtn,#toggleScreen,#showOnNotebook{display:none!important}
  #themeBtn,#saveBtn{display:inline-block!important}
  .tools .right{gap:10px}

  /* ===== Caja de Pistas ===== */
  .xp-nav-wrap{position:relative; z-index:12050; display:grid; place-items:center; padding:16px;}
  .xp-nav{width:min(960px, 92vw); background:rgba(0,0,0,.66); border:1px solid rgba(255,255,255,.18);
          border-radius:16px; padding:clamp(14px,2vw,22px); box-shadow:0 22px 50px rgba(0,0,0,.55);
          backdrop-filter:blur(4px); position:relative;}
  .xp-title{margin:0 0 8px; color:#fff; font-weight:900; letter-spacing:.2px;
            font-size:clamp(1.1rem,.9rem + 1.8vw,1.8rem); text-shadow:0 2px 10px rgba(0,0,0,.7);}
  .xp-phrase{margin:0 0 14px; color:#eaeaea; font-style:italic; opacity:.95; font-size:clamp(.95rem,.9rem + .6vw,1.1rem);}
  .xp-grid{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px; margin-top:8px;}
  .xp-btn{display:inline-block; text-align:center; text-decoration:none; cursor:pointer; background:#fff; color:#000;
          border:1px solid #fff; border-radius:12px; padding:10px 12px; font-weight:800; box-shadow:0 8px 24px rgba(0,0,0,.45);}
  .xp-btn:active{transform:translateY(1px)}
  @media (max-width:680px){ .xp-grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
  .xp-close{position:absolute; left:12px; top:10px; width:32px; height:32px; border-radius:50%;
            background:transparent; color:#fff; border:1px solid rgba(255,255,255,.6); font-weight:900; cursor:pointer;}
  .xp-hidden{display:none!important}
  .xp-open{position:fixed; right:14px; bottom:14px; z-index:12060; display:none; align-items:center; gap:8px;
           background:rgba(0,0,0,.6); color:#fff; border:1px solid #fff; border-radius:10px; padding:8px 12px; font-weight:800; cursor:pointer}
</style>
</head>
<body>

  <!-- ===== HERO ===== -->
  <section class="hero" data-blood="1">
    <div class="bg" style="background-image:url('reloj.jpg')"></div>
    <div class="shade"></div>
    <div class="blood" id="blood" data-on="1"></div>

    <div class="panel" id="phrasePanel">
      <button class="closePhrase" id="closePhrase" title="Cerrar frase" aria-label="Cerrar frase">×</button>
      <p class="q">“Cada mañana a las 8:30, el reloj marcaba lo mismo. Las agujas brillaban, como si guardaran el secreto de quien las tocaba.”</p>
      <p class="meta">Archivo #P-01 — Bitácora de estación. Frecuencia: 8:30 h.</p>
      <div class="actions">
        <button class="btn" id="openNotes" type="button" aria-haspopup="dialog" aria-controls="notesModal">Abrir libreta</button>
        <button class="btn btn-ghost" id="downloadNotesTop" type="button">Descargar pistas</button>
        <span class="slot-volver"><!-- ej: <a href="index.html" class="volver">Volver</a> --></span>
      </div>
    </div>
  </section>

  <!-- Botón flotante para volver a mostrar la frase -->
  <button class="showPhrase" id="showPhrase" type="button">Mostrar frase</button>

  <!-- ===== MODAL LIBRETA ===== -->
  <section class="notes" data-key="pistas_reloj_bn">
    <div class="modal" id="notesModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="notesTitle">
      <div class="backdrop" data-close></div>
      <div class="mw">
        <div class="book" aria-hidden="true"></div>

        <div class="page" id="page">
          <header class="head">
            <h3 class="ttl" id="notesTitle">Mi libreta</h3>
            <button class="close" type="button" data-close aria-label="Cerrar">×</button>
          </header>

          <div class="tools">
            <div class="left">
              <button class="toggle" id="themeBtn">Tema: Negro</button>
              <button class="toggle" id="toolPen">Lápiz</button>
              <button class="toggle" id="toolEraser">Goma</button>
            </div>
            <div class="right">
              <button class="ctl" id="saveBtn"  type="button">Guardar</button>
              <button class="ctl" id="downloadNotesIn" type="button">Descargar</button>
              <button class="ctl" id="clearBtn" type="button">Borrar</button>
            </div>
          </div>

          <label class="label" for="ta">Escribe tus pistas:</label>
          <p style="color:#ccc; font-style:italic; font-size:0.95em; margin:6px 0 10px;">
            “Anota aquí tus observaciones.<br/>Cada detalle puede alterar la secuencia del tiempo.”
          </p>
          <textarea class="ta" id="ta" placeholder="Escribe aquí..."></textarea>
          <canvas class="board" id="board"></canvas>
          <footer class="ft"><small>Se guarda en este navegador. Puedes descargar tus pistas desde aquí o desde la portada.</small></footer>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== CAJA DE PISTAS (con X) ===== -->
  <div id="xpNav" class="xp-nav-wrap">
    <div class="xp-nav">
      <button class="xp-close" aria-label="Cerrar pista" title="Cerrar">×</button>
      <h2 class="xp-title">Elige tu siguiente pista…</h2>
      <p class="xp-phrase">Cada pista abre una puerta distinta en el tiempo.</p>
      <div class="xp-grid">
        <a class="xp-btn" href="p01.html">Pista 1</a>
        <a class="xp-btn" href="p02.html">Pista 2</a>
        <a class="xp-btn" href="p03.html">Pista 3</a>
        <a class="xp-btn" href="p04.html">Pista 4</a>
        <a class="xp-btn" href="p05.html">Pista 5</a>
        <a class="xp-btn" href="index.html">Portada</a>
      </div>
    </div>
  </div>
  <button id="xpOpen" class="xp-open" type="button">Pistas</button>
  <!-- ===== FIN CAJA DE PISTAS ===== -->

<script>
(() => {
  /* ===== Frase: cerrar/mostrar ===== */
  const phrasePanel = document.getElementById('phrasePanel');
  const closePhrase = document.getElementById('closePhrase');
  const showPhrase  = document.getElementById('showPhrase');
  closePhrase.addEventListener('click', () => { phrasePanel.classList.add('hidden'); showPhrase.style.display='inline-block'; });
  showPhrase.addEventListener('click', () => { phrasePanel.classList.remove('hidden'); showPhrase.style.display='none'; });

  /* ===== Libreta ===== */
  const wrapper   = document.querySelector('.notes');
  const storageKey= 'notes_' + (wrapper?.dataset?.key || 'pista');

  const openBtn   = document.getElementById('openNotes');
  const modal     = document.getElementById('notesModal');
  const backdrops = modal.querySelectorAll('[data-close]');
  const page      = document.getElementById('page');

  const themeBtn  = document.getElementById('themeBtn');
  const toolPen   = document.getElementById('toolPen');
  const toolEra   = document.getElementById('toolEraser');

  const saveBtn   = document.getElementById('saveBtn');
  const clearBtn  = document.getElementById('clearBtn');
  const dlTop     = document.getElementById('downloadNotesTop');
  const dlIn      = document.getElementById('downloadNotesIn');

  const ta        = document.getElementById('ta');
  const board     = document.getElementById('board');
  const ctx       = board.getContext('2d');

  const blood     = document.getElementById('blood');

  let tool = 'pencil';
  function isLight(){ return page.classList.contains('light'); }
  function penColor(){ return isLight() ? '#000' : '#fff'; }

  function openModal(){
    modal.setAttribute('aria-hidden','false');
    phrasePanel.classList.add('hidden'); showPhrase.style.display='inline-block';
    blood.classList.remove('flood');

    try{
      const data = JSON.parse(localStorage.getItem(storageKey) || '{}');
      if (data.text) ta.value = data.text;
      if (data.img){
        const img = new Image();
        img.onload = () => { resizeBoard(); ctx.clearRect(0,0,board.width,board.height); ctx.drawImage(img,0,0,board.width,board.height); };
        img.src = data.img;
      } else { resizeBoard(); }
      if (data.theme === 'light'){ page.classList.add('light'); themeBtn.textContent='Tema: Blanco'; }
      else { page.classList.remove('light'); themeBtn.textContent='Tema: Negro'; }
    }catch(e){ resizeBoard(); }

    setTimeout(()=>ta.focus(),40);
    document.addEventListener('keydown', escClose);
  }
  function closeModal(){
    modal.setAttribute('aria-hidden','true');
    document.removeEventListener('keydown', escClose);
    blood.classList.add('flood');
  }
  function escClose(e){ if(e.key==='Escape') closeModal(); }

  openBtn.addEventListener('click', openModal);
  backdrops.forEach(el=>el.addEventListener('click', closeModal));

  themeBtn.addEventListener('click', ()=>{ page.classList.toggle('light');
    themeBtn.textContent = isLight() ? 'Tema: Blanco' : 'Tema: Negro'; resizeBoard(); });
  toolPen.addEventListener('click', ()=> tool='pencil');
  toolEra.addEventListener('click', ()=> tool='eraser');

  function resizeBoard(){
    const r = board.getBoundingClientRect();
    const tmp = document.createElement('canvas'); tmp.width = r.width; tmp.height = r.height;
    tmp.getContext('2d').drawImage(board,0,0,r.width,r.height);
    board.width = r.width; board.height = r.height;
    ctx.drawImage(tmp,0,0); ctx.lineCap='round'; ctx.lineJoin='round'; ctx.lineWidth=2.2;
    ctx.strokeStyle = penColor(); ctx.globalCompositeOperation='source-over';
  }
  new ResizeObserver(resizeBoard).observe(board);

  let drawing=false,lastX=0,lastY=0;
  function start(x,y){ drawing=true; [lastX,lastY]=[x,y]; }
  function move(x,y){
    if(!drawing) return;
    if(tool==='pencil'){ ctx.globalCompositeOperation='source-over'; ctx.strokeStyle = penColor(); }
    else{ ctx.globalCompositeOperation='destination-out'; ctx.strokeStyle='rgba(0,0,0,1)'; }
    ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(x,y); ctx.stroke(); [lastX,lastY]=[x,y];
  }
  function end(){ drawing=false; }
  function pos(ev){ const r=board.getBoundingClientRect();
    if(ev.touches && ev.touches[0]) return {x:ev.touches[0].clientX-r.left,y:ev.touches[0].clientY-r.top};
    return {x:ev.clientX-r.left,y:ev.clientY-r.top}; }
  board.addEventListener('mousedown', e=>{const p=pos(e); start(p.x,p.y);});
  board.addEventListener('mousemove', e=>{const p=pos(e); move(p.x,p.y);});
  window.addEventListener('mouseup', end);
  board.addEventListener('touchstart', e=>{const p=pos(e); start(p.x,p.y); e.preventDefault();},{passive:false});
  board.addEventListener('touchmove',  e=>{const p=pos(e); move(p.x,p.y);  e.preventDefault();},{passive:false});
  window.addEventListener('touchend', end, {passive:true});

  function save(){
    const data = { text: ta.value || '', img: board.toDataURL('image/png'), theme: isLight() ? 'light' : 'dark' };
    localStorage.setItem(storageKey, JSON.stringify(data));
    saveBtn.textContent='Guardado ✓'; setTimeout(()=> saveBtn.textContent='Guardar', 900);
  }
  saveBtn.addEventListener('click', save);

  let autosave; ta.addEventListener('input', ()=>{ clearTimeout(autosave); autosave=setTimeout(save, 800); });

  clearBtn.addEventListener('click', ()=>{ if(!confirm('¿Borrar la nota y el dibujo?')) return;
    localStorage.removeItem(storageKey); ta.value=''; ctx.clearRect(0,0,board.width,board.height); });

  function downloadNotes(){
    const stored = JSON.parse(localStorage.getItem(storageKey) || '{}');
    const frase  = document.querySelector('.q')?.textContent?.trim() || '';
    const meta   = document.querySelector('.meta')?.textContent?.trim() || '';
    const text   = stored.text || '';
    const content = `Pista:\n${frase}\n\n${meta?meta+"\n\n":""}Notas del lector:\n${text || "(vacío)"}\n`;
    const blob = new Blob([content], {type:'text/plain;charset=utf-8'});
    const url  = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='pistas.txt';
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  dlTop.addEventListener('click', downloadNotes);
  dlIn.addEventListener('click', downloadNotes);
})();
</script>

<!-- Parche: scroll y foco en textarea al abrir -->
<style>.page{overflow:auto!important}.ta{display:block!important;min-height:260px!important}.mw{align-items:center!important}</style>
<script>
(function(){const openBtn=document.getElementById('openNotes');const page=document.getElementById('page');const ta=document.getElementById('ta');
if(openBtn&&page&&ta){openBtn.addEventListener('click',()=>{setTimeout(()=>{page.scrollTop=0;ta.focus();},100);});}})();
</script>

<!-- Oculta canvas de dibujo si no lo necesitas (lo dejo como en tu versión) -->
<style>
#board,canvas.board{display:none!important;height:0!important;margin:0!important;padding:0!important;border:0!important}
.ft{display:none!important}
</style>

<!-- ===== HISTORIAL debajo del textarea: C (1ª) / Borrar última / Borrar todo ===== -->
<script>
(function() {
  const wrapper  = document.querySelector('.notes');
  const notesKey = 'notes_' + (wrapper?.dataset?.key || 'pista');
  const histKey  = 'exbw_libreta_historial';

  const ta      = document.getElementById('ta');
  const saveBtn = document.getElementById('saveBtn');

  const box = document.createElement('div');
  box.className = 'exbw-hist';
  Object.assign(box.style,{marginTop:'14px',padding:'10px',border:'1px dashed #666',borderRadius:'10px',color:'#ccc'});

  const title = document.createElement('div');
  title.innerHTML = '<strong>Así queda en tu libreta:</strong>';
  title.style.marginBottom='8px';

  const list = document.createElement('div');

  const row = document.createElement('div');
  Object.assign(row.style,{display:'flex',gap:'10px',flexWrap:'wrap',marginTop:'10px'});

  // Botones: C (borrar primera), Borrar última, Borrar todo
  const btnFirst=document.createElement('button');
  btnFirst.type='button'; btnFirst.textContent='C';
  btnFirst.title='Borrar la primera entrada';
  Object.assign(btnFirst.style,{padding:'6px 10px',borderRadius:'8px',border:'1px solid #888',background:'transparent',color:'inherit',cursor:'pointer'});

  const btnLast=document.createElement('button');
  btnLast.type='button'; btnLast.textContent='Borrar última';
  Object.assign(btnLast.style,{padding:'6px 10px',borderRadius:'8px',border:'1px solid #888',background:'transparent',color:'inherit',cursor:'pointer'});

  const btnAll=document.createElement('button');
  btnAll.type='button'; btnAll.textContent='Borrar todo';
  Object.assign(btnAll.style,{padding:'6px 10px',borderRadius:'8px',border:'1px solid #888',background:'transparent',color:'inherit',cursor:'pointer'});

  row.append(btnFirst, btnLast, btnAll);
  box.append(title, list, row);
  ta?.parentNode?.insertBefore(box, ta.nextSibling);

  function loadHist(){ try{ return JSON.parse(localStorage.getItem(histKey)||'[]'); }catch(_){ return []; } }
  function saveHist(arr){ localStorage.setItem(histKey, JSON.stringify(arr||[])); }
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  function render(){
    const items=loadHist();
    if(!items.length){ list.innerHTML='<em>(Vacío)</em>'; btnFirst.disabled=btnLast.disabled=btnAll.disabled=true; return; }
    btnFirst.disabled=btnLast.disabled=btnAll.disabled=false;
    list.innerHTML=items.map(t=>`<p style="margin:.4em 0;">${escapeHtml(t)}</p>`).join('');
  }

  if(saveBtn){ saveBtn.addEventListener('click', ()=>{ const txt=(ta?.value||'').trim(); if(!txt) return;
    const items=loadHist(); items.push(txt); saveHist(items); render(); ta.value=''; }); }

  btnFirst.addEventListener('click', ()=>{ const items=loadHist(); if(!items.length) return alert('No hay nada que borrar.');
    if(!confirm('¿Borrar la PRIMERA entrada?')) return; items.shift(); saveHist(items); render(); });

  btnLast.addEventListener('click', ()=>{ const items=loadHist(); if(!items.length) return alert('No hay nada que borrar.');
    if(!confirm('¿Borrar la ÚLTIMA entrada?')) return; items.pop(); saveHist(items); render(); });

  btnAll.addEventListener('click', ()=>{ if(!confirm('¿Borrar TODO (texto/dibujo + historial)?')) return;
    localStorage.removeItem(histKey); localStorage.removeItem(notesKey);
    if(ta) ta.value=''; const canvas=document.getElementById('board'); const ctx=canvas?.getContext?.('2d'); if(ctx) ctx.clearRect(0,0,canvas.width,canvas.height);
    render(); });

  render();
})();
</script>

<!-- ===== Caja de pistas: cerrar con X y reabrir con “Pistas” ===== -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const box = document.getElementById('xpNav');
  if (!box) return;

  const btnClose = box.querySelector('.xp-close');
  const btnOpen  = document.getElementById('xpOpen');

  function hideBox(){ box.classList.add('xp-hidden'); btnOpen.style.display='inline-flex'; }
  function showBox(){ box.classList.remove('xp-hidden'); btnOpen.style.display='none';
    try{ window.scrollTo({ top: box.offsetTop - 24, behavior:'smooth' }); }catch(e){} }

  if (btnClose) btnClose.addEventListener('click', hideBox);
  btnOpen.addEventListener('click', showBox);
  btnOpen.style.display='none'; // visible solo cuando se cierra
});
</script>

<!-- Ocultar “próximamente”, cronómetro y enlaces -->
<style>
  #countdown,.countdown,#comingSoon,.coming-soon,.soon,.soon-link,.soonBox,.proximamente,.proximo,a.soon,a.proximamente{display:none!important}
</style>
<script>
(function(){
  const hideByText=(root,words=[])=>{const w=document.createTreeWalker(root,NodeFilter.SHOW_ELEMENT,null);
    while(w.nextNode()){const el=w.currentNode;const t=(el.textContent||'').toLowerCase().trim(); if(!t) continue;
      if(words.some(s=>t.includes(s))) el.style.display='none';}};
  hideByText(document.body,['próximamente','proximamente']);
  document.querySelectorAll('[data-countdown],[data-counter],[data-timer]').forEach(el=>el.style.display='none');
  document.querySelectorAll('a').forEach(a=>{const t=(a.textContent||'').toLowerCase(); if(t.includes('próximamente')||t.includes('proximamente')) a.style.display='none';});
})();
</script>

</body>
</html>









































